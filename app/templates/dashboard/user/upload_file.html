{% extends 'base.html' %}

{% block title %}Envio de Documentos{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h3 class="text-center mb-5">Envio de Documentos</h3>

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- CREA -->
        <div class="mb-4">
          <label class="form-label">CREA</label>
          <div>
            <button type="button" class="btn btn-outline-secondary w-100 mb-2"
              onclick="document.getElementById('id_crea').click()">
              {% if documents_uploaded.crea %}Alterar arquivo{% else %}Escolher arquivo{% endif %}
            </button>
            <input type="file" name="crea" id="id_crea" class="d-none">
          </div>
          <input type="text" name="crea_number" class="form-control" placeholder="Número do CREA"
            value="{{ form.crea_number.value|default:'' }}">
        </div>

        <!-- Passaporte -->
        <div class="mb-4">
          <label class="form-label">Passaporte</label>
          <div>
            <button type="button" class="btn btn-outline-secondary w-100 mb-2"
              onclick="document.getElementById('id_passport').click()">
              {% if documents_uploaded.passport %}Alterar arquivo{% else %}Escolher arquivo{% endif %}
            </button>
            <input type="file" name="passport" id="id_passport" class="d-none">
          </div>
          <input type="text" name="passport_number" class="form-control" placeholder="Número do Passaporte"
            value="{{ form.passport_number.value|default:'' }}">
        </div>

        <!-- CPF -->
        <div class="mb-4">
          <label class="form-label">CPF</label>
          <div>
            <button type="button" class="btn btn-outline-secondary w-100 mb-2"
              onclick="document.getElementById('id_cpf').click()">
              {% if documents_uploaded.cpf %}Alterar arquivo{% else %}Escolher arquivo{% endif %}
            </button>
            <input type="file" name="cpf" id="id_cpf" class="d-none">
          </div>
          <input type="text" name="cpf_number" class="form-control" placeholder="Número do CPF"
            value="{{ form.cpf_number.value|default:'' }}">
        </div>

        <!-- RG -->
        <div class="mb-4">
          <label class="form-label">RG</label>
          <div>
            <button type="button" class="btn btn-outline-secondary w-100 mb-2"
              onclick="document.getElementById('id_rg').click()">
              {% if documents_uploaded.rg %}Alterar arquivo{% else %}Escolher arquivo{% endif %}
            </button>
            <input type="file" name="rg" id="id_rg" class="d-none">
          </div>
          <input type="text" name="rg_number" class="form-control" placeholder="Número do RG"
            value="{{ form.rg_number.value|default:'' }}">
        </div>

        <div class="text-center mt-5">
          <button type="submit" id="submitBtn" class="btn btn-secondary px-4" disabled>Enviar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .btn-outline-secondary {
    border: 1px solid #dee2e6;
    color: #6c757d;
    background: white;
    padding: 0.375rem 0.75rem;
    font-size: 0.9em;
  }

  .btn-outline-secondary:hover {
    background-color: #f8f9fa;
    border-color: #dee2e6;
    color: #6c757d;
  }

  .form-control {
    border: 1px solid #dee2e6;
    padding: 0.5rem 0.75rem;
  }

  .form-label {
    color: #212529;
    font-weight: normal;
    margin-bottom: 0.5rem;
  }

  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }

  .notification-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #dc3545;
    color: white;
    border-radius: 50%;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    font-weight: bold;
    min-width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .profile-wrapper {
    position: relative;
    display: inline-block;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const pairs = [
      { file: 'id_crea', number: 'id_crea_number' },
      { file: 'id_passport', number: 'id_passport_number' },
      { file: 'id_cpf', number: 'id_cpf_number' },
      { file: 'id_rg', number: 'id_rg_number' }
    ];

    const submitBtn = document.getElementById('submitBtn');

    function checkForm() {
      let shouldEnable = true;
      let hasAnyFile = false;

      pairs.forEach(pair => {
        console.log(pair)
        const fileInput = document.getElementById(pair.file);
        const numberInput = document.getElementById(pair.number);

        if (fileInput.files.length > 0) {
          hasAnyFile = true;
          if (!numberInput.value.trim()) {
            shouldEnable = false;
          }
        }
      });

      // Enable if either no files are selected, or all files have numbers
      submitBtn.disabled = hasAnyFile ? !shouldEnable : false;
    }

    // Add event listeners
    pairs.forEach(pair => {
      const fileInput = document.getElementById(pair.file);
      const numberInput = document.getElementById(pair.number);

      fileInput.addEventListener('change', checkForm);
      numberInput.addEventListener('input', checkForm);
    });

    // Initial check
    checkForm();
  });
</script>
{% endblock %}