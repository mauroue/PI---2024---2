{% extends "base.html" %}

{% block title %}Tarefas Disponíveis{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="acessibilidade">
        <!-- Botões para aumentar ou diminuir a fonte -->
        <button onclick="aumentarFonte()" 
        style="border: 1px solid white; 
               background-color: rgba(173, 216, 230, 0.5); 
               color: rgb(25, 118, 211); 
               padding: 6px 14px; 
               font-size: 14px; 
               border-radius: 8px; 
               cursor: pointer; 
               transition: background-color 0.3s, color 0.3s; 
               margin-bottom: 10px;">
        Aumentar Fonte
        </button>
        <button onclick="diminuirFonte()" 
                style="border: 2px solid white; 
                    background-color: rgba(173, 216, 230, 0.5); 
                    color: rgb(25, 118, 211); 
                    padding: 6px 14px; 
                    font-size: 14px; 
                    border-radius: 8px; 
                    cursor: pointer; 
                    transition: background-color 0.3s, color 0.3s; 
                    margin-bottom: 10px;">
            Diminuir Fonte
        </button>
        <script>
            function aumentarFonte() {
                let html = document.documentElement; 
                let style = window.getComputedStyle(html, null).getPropertyValue('font-size');
                let currentSize = parseFloat(style);
                html.style.fontSize = (currentSize + 1) + 'px';  // Aumenta a fonte em 1px
            }
            
            function diminuirFonte() {
                let html = document.documentElement;
                let style = window.getComputedStyle(html, null).getPropertyValue('font-size');
                let currentSize = parseFloat(style);
                html.style.fontSize = (currentSize - 1) + 'px';  // Diminui a fonte em 1px
            }                    
        </script>
    </div>
    <h2 class="text-center mb-4">Tarefas Disponíveis</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Título</th>
                <th>Descrição</th>
                <th>Status</th>
                <th>Solicitante</th>
                <th>Criado em</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for work_request in work_requests %}
            <tr>
                <td>{{ work_request.title }}</td>
                <td>{{ work_request.description }}</td>
                <td>{{ work_request.status }}</td>
                <td>{{ work_request.requester.username }}</td>
                <td>{{ work_request.created_at }}</td>
                <td>
                    {% if work_request.requester == request.user %}
                    <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal"
                        data-bs-target="#actionModal" data-action="cancel" data-work-request-id="{{ work_request.id }}">
                        Cancelar
                    </button>
                    {% elif work_request.requester != request.user and request.user.profile.status != 'approved' %}
                    <span class="d-inline-block" tabindex=0 data-toggle="tooltip" data-placement="top"
                        title="Valide seus documentos no seu perfil para aplicar em trabalhos.">
                        <button type="button" class="btn btn-primary btn-sm" disabled>
                            Aplicar
                        </button>
                    </span>
                    {% else %}
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                        data-bs-target="#proposalModal" data-work-request-id="{{ work_request.id }}">
                        Aplicar
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Add this modal at the end of your template -->
<div class="modal fade" id="proposalModal" tabindex="-1" aria-labelledby="proposalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="proposalModalLabel">Criar Proposta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <!-- The form will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Add this script at the end of your template -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var proposalModal = document.getElementById('proposalModal');
        proposalModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var workRequestId = button.getAttribute('data-work-request-id');
            var modalBody = proposalModal.querySelector('.modal-body');

            // Load the form via AJAX
            fetch(`/create-proposal/${workRequestId}/`)
                .then(response => response.text())
                .then(html => {
                    modalBody.innerHTML = html;
                });
        });
    });
</script>
<style>
    <style>
        .container mt-5 .acessibilidade {
          position: fixed;
          top: 20%;
          left: 1050px;
          transform: translateY(-50%); 
      }
      
        .container mt-5 .acessibilidade button:hover {
            background-color: blue; 
            color: white;  
        }
      
        .container mt-5 .acessibilidade button:focus {
            outline: none; 
            box-shadow: 0 0 5px blue;  
        }
      </style>
</style>
{% endblock %}