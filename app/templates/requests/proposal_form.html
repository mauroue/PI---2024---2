<form id="proposalForm" method="post" action="{% url 'submit_proposal' work_request.id %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Submit Proposal</button>
</form>

<script>
    document.getElementById('proposalForm').addEventListener('submit', function (e) {
        e.preventDefault();
        var form = this;
        fetch(form.action, {
            method: 'POST',
            body: new FormData(form),
            headers: {
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Proposal submitted successfully!');
                    var modal = bootstrap.Modal.getInstance(document.getElementById('proposalModal'));
                    modal.hide();
                } else {
                    alert('Error submitting proposal. Please try again.');
                }
            });
    });
</script>